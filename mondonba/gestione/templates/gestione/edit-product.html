{% extends "base.html" %}

{% block head %} {% endblock %}

{% block title %}{{title}}{% endblock %}

{% load static %}

{% block content%}


	<!-- Shoping Cart -->
	<div class="bg0 p-t-75 p-b-85">
		<div class="container">
			<div class="row">
				<div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
					<div class="m-l-25 m-r--38 m-lr-0-xl">
						<div class="wrap-table-shopping-cart">
							<table class="table-shopping-cart">
								<tr class="table_head">
									<th class="column-1">Id</th>
									<th class="column-2">Image</th>
									<th class="column-3">Name</th>
									<th class="column-3" style="text-align: center">Price</th>
									<th class="column-3" style="text-align: center">Valuation</th>
									<th class="column-3" style="text-align: center">Category</th>
									<th class="column-5" style="text-align: center; width: 100px">Description</th>
								</tr>

								{% for product in object_list %}

									<tr class="table_row">
										<td class="column-1">{{product.id}}</td>
										<td class="column-2">
											<div class="how-itemcart1">
												<img src="{{product.image.url}}" alt="IMG">
											</div>
										</td>
										<td class="column-3">{{product.name}}</td>
										<td class="column-3" style="text-align: center">{{product.price}}</td>
										<td class="column-3" style="text-align: center">{{product.valuation}}</td>
										<td class="column-3" style="text-align: center">{{product.category}}</td>
										<td class="column-5" style="text-align: center">{{product.description}}</td>
									</tr>


								{% endfor %}

							</table>
						</div>

						<form class="flex-w flex-sb-m bor15 p-t-18 p-b-15 p-lr-40 p-lr-15-sm" method="get">
							<div class="flex-w flex-m m-r-20 m-tb-5" style="margin: 0 auto">
								<div class="wrap-num-product flex-w m-l-auto m-r-0">
									<button></button>
									<button class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m">
										<i class="fs-16 zmdi zmdi-chevron-left"></i>
									</button>
									<input oninput="acceptableValue(this)" onkeyup="acceptableValue(this)" class="mtext-104 cl3 txt-center num-product" id="page" min = "1" type="number" name="page" value="{{request.GET.page}}">
									<button class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m">
										<i class="fs-16 zmdi zmdi-chevron-right"></i>
									</button>
								</div>
							</div>
						</form>

					</div>
				</div>

				<div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50">
					<form class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm" action="{% url 'gestione:edit_product_action' %}" method="post" enctype="multipart/form-data">
						{% csrf_token %}

						<h4 class="mtext-109 cl2 p-b-30">
							Edit Product
						</h4>

						<div class="flex-w flex-t bor12 p-t-15 p-b-30">
							<div class="size-208 w-full-ssm">
								<span class="stext-110 cl2">
									Action:
								</span>
							</div>

							<div class="size-209 p-r-18 p-r-0-sm w-full-ssm">
								<div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9">
									<select class="js-select2" name="action" id ="method" required>
										<option>Create</option>
										<option>Delete</option>
										<option>Update</option>
									</select>
									<div class="dropDownSelect2"></div>
								</div>
							</div>
						</div>

						<div class="flex-w flex-t bor12 p-t-15 p-b-30">
							<div class="size-208 w-full-ssm">
								<span class="stext-110 cl2">
									Data:
								</span>
							</div>

							<div class="size-209 p-r-18 p-r-0-sm w-full-ssm">
								
								<div class="p-t-15">


									<div class="bor8 bg0 m-b-12 delete" style="display: none">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15 input-delete" type="text" name="deleteId" placeholder="Id">
									</div>

									<div class="bor8 bg0 m-b-12 update" style="display: none">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15 input-update" type="text" name="updateId" placeholder="Id">
									</div>

									<div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9 update" style="display: none">
										<select class="js-select2 input-update" name="whatField" id = "whatField">
											<option>Image</option>
											<option>Name</option>
											<option>Price</option>
											<option>Valuation</option>
											<option>Category</option>
											<option>Description</option>
										</select>
										<div class="dropDownSelect2"></div>
									</div>

									<div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9 categoryUpdate" style="display: none">
										<select class="js-select2" name="field" id="updateCategory">
											<option>Clothing</option>
											<option>Tool</option>
											<option>Gadget</option>
										</select>
										<div class="dropDownSelect2"></div>
									</div>

									<div class="bor8 bg0 m-b-12 categoryUpdate imageUpdate" style="display: none">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" id = "field" name="field" placeholder="Field">
									</div>

									<div class="bg0 m-b-12 mb-3 update imageUpdate" style="display:none;">
										<input class="stext-111 cl8 plh3 size-111 p-lr-5 input-update" id = "updateImage" accept="image/*" type="file" name="field" placeholder="Image">
									</div>

									<div class="bg0 m-b-12 mb-3 create">
										<input class="stext-111 cl8 plh3 size-111 p-lr-5 input-create" accept="image/*" type="file" name="image" placeholder="Image" required>
									</div>

									<div class="bor8 bg0 m-b-22 create">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15 input-create" type="text" name="name" placeholder="Name" required>
									</div>

									<div class="bor8 bg0 m-b-12 create">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15 input-create" type="number" step="0.01" name="price" placeholder="Price" required>
									</div>

									<div class="bor8 bg0 m-b-22 create">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15 input-create" min = "0" max = "5" type="number" name="valuation" placeholder="Valuation" required>
									</div>

									<div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9 create">
										<select class="js-select2 input-create" name="category" id = "category" required>
											<option>Clothing</option>
											<option>Tool</option>
											<option>Gadget</option>
										</select>
										<div class="dropDownSelect2"></div>
									</div>

									<div class="bor8 bg0 m-b-22 create">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15 input-create" type="text" name="description" placeholder="Description" required>
									</div>
										
								</div>
							</div>
						</div>

						<button class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer">
							Submit
						</button>
					</form>
				</div>
			</div>
		</div>
	</div>

{% endblock %}

{% block script %}

	<script>
		document.getElementById("page").setAttribute("max", Math.ceil(parseInt("{{count}}")/5) )

	</script>

	<script>
		message = "{{message}}"

		if(message != ""){
			if(message.includes("Error")){
				sweetAlert("Error", message, "error");
			}
			else{
				sweetAlert("Success", message, "success");
			}
		}


		function acceptableValue(value){
			if(value.value > Math.ceil(parseInt("{{count}}")/5)) {
				value.value = Math.ceil(parseInt("{{count}}")/5);
			}

			if(value.value < 1) {
				value.value = 1;
			}
		}

		var method = document.getElementById('method');

		method.onchange = changeListener;

		function changeListener(){
			var value = method.value

				if(value == "Create"){
					for (let i = 0; i < document.getElementsByClassName("create").length; i++) {
						document.getElementsByClassName("create")[i].style.display = "block"
						document.getElementsByClassName("input-create")[i].required = true
					}

						document.getElementsByClassName("delete")[0].style.display = "none"
						document.getElementsByClassName("input-delete")[0].required = false

					for (let i = 0; i < document.getElementsByClassName("update").length; i++) {
						document.getElementsByClassName("update")[i].style.display = "none"
						document.getElementsByClassName("input-update")[i].required = false

					}
				}

				if(value == "Delete"){

					document.getElementsByClassName("delete")[0].style.display = "block"
					document.getElementsByClassName("input-delete")[0].required = true

					for (let i = 0; i < document.getElementsByClassName("create").length; i++) {
						document.getElementsByClassName("input-create")[i].required = false
						document.getElementsByClassName("create")[i].style.display = "none"
					}

					for (let i = 0; i < document.getElementsByClassName("update").length; i++) {
						document.getElementsByClassName("update")[i].style.display = "none"
						document.getElementsByClassName("input-update")[i].required = false
					}
				}

				if(value == "Update"){
					for (let i = 0; i < document.getElementsByClassName("update").length; i++) {
						document.getElementsByClassName("update")[i].style.display = "block"
						document.getElementsByClassName("input-update")[i].required = true
					}

					for (let i = 0; i < document.getElementsByClassName("create").length; i++) {
						document.getElementsByClassName("create")[i].style.display = "none"
						document.getElementsByClassName("input-create")[i].required = false
					}

					document.getElementsByClassName("delete")[0].style.display = "none"
					document.getElementsByClassName("input-delete")[0].required = false

				}

		}

		window.onload = function (){
			if (document.getElementById("page").value == ""){
				document.getElementById("page").setAttribute("value", 1)
			}

			if(parseInt(document.getElementById("page").value) > Math.ceil(parseInt("{{count}}")/5)){
				document.location.href = "http://127.0.0.1:8000/gestione/edit_product/?page=" +  Math.ceil(parseInt("{{count}}")/5)
			}

		}

		var whatField = document.getElementById('whatField');
		whatField.onchange = function (){
			document.getElementsByClassName("categoryUpdate")[1].style.display = "block"
			document.getElementsByClassName("categoryUpdate")[0].style.display = "none"
			document.getElementsByClassName("imageUpdate")[1].style.display = "none"
			document.getElementById("updateCategory").setAttribute("name", "")
			document.getElementById("updateCategory").required = false
			document.getElementById("field").setAttribute("name", "field")
			document.getElementById("updateImage").setAttribute("name", "")
			document.getElementById("updateImage").required = false
			document.getElementById("field").required = true

			//alert(whatField.value)
			if(whatField.value == "Valuation"){
				document.getElementById("field").setAttribute("max", 5)
				document.getElementById("field").setAttribute("min", 0)
				document.getElementById("field").setAttribute("type", "number")
			}

			if(whatField.value == "Price"){
				document.getElementById("field").setAttribute("type", "number")
				document.getElementById("field").setAttribute("step", "0.01")
			}

			if(whatField.value == "Image"){
				document.getElementsByClassName("imageUpdate")[0].style.display = "none"
				document.getElementsByClassName("imageUpdate")[1].style.display = "block"
				document.getElementById("updateImage").setAttribute("name", "field")
				document.getElementById("field").setAttribute("name", "")
				document.getElementById("field").required = false
				document.getElementById("updateImage").required = true
			}

			if(whatField.value == "Category"){
				document.getElementsByClassName("categoryUpdate")[0].style.display = "block"
				document.getElementsByClassName("categoryUpdate")[1].style.display = "none"
				document.getElementById("updateCategory").setAttribute("name", "field")
				document.getElementById("field").setAttribute("name", "")
				document.getElementById("field").required = false
				document.getElementById("updateCategory").required = true

			}
		}



	</script>

	<script>
		$(".js-select2").each(function(){
			$(this).select2({
				minimumResultsForSearch: 20,
				dropdownParent: $(this).next('.dropDownSelect2')
			});
		})
	</script>

	<script>
		$('.js-pscroll').each(function(){
			$(this).css('position','relative');
			$(this).css('overflow','hidden');
			var ps = new PerfectScrollbar(this, {
				wheelSpeed: 1,
				scrollingThreshold: 1000,
				wheelPropagation: false,
			});

			$(window).on('resize', function(){
				ps.update();
			})
		});
	</script>

{% endblock %}